const express = require('express');
const bodyParser = require('body-parser');
const { Client } = require('@line/bot-sdk');

// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö LINE API
const client = new Client({
    channelAccessToken: 'OBl0VxxX43CjHrhrWrm5MU0ECN0TmyAaPebW7ZbmKfUbHwcPsfGhzIxMZ/7x7xcDWYP1Y17A7VhwOZkKCjlv7KqUUt604LAssC6b1rvq5/h4QSMmrcSkF3T1kYcQOpuzxQNCkbIwsTKdLPd8eY7/8wdB04t89/1O/w1cDnyilFU=',
    channelSecret: '78b63d2c720ca2cd2b1d7c9b7bfb0cb4',
});

const app = express();
const port = process.env.PORT || 3000;

app.use(bodyParser.json());

// Webhook endpoint ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å LINE OA
app.post('/webhook', async (req, res) => {
    try {


        const events = req.body.events;

        for (const event of events) {
            const userId = event.source.userId;
            console.log("userId", userId)
            console.log("type", event.type)
            if (event.type === 'message' && event.message.type === 'image') {
                const messageId = event.message.id;
                console.log("message", event.message.text)

                try {
                    // ‡∏î‡∏∂‡∏á binary content ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å LINE
                    // const stream = await client.getMessageContent(messageId);

                    // // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°/‡∏°‡∏µ timestamp
                    // const filename = `upload_${userId}_${Date.now()}.jpg`;
                    // const filepath = path.join(__dirname, 'uploads', filename);

                    // // ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå uploads ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
                    // fs.mkdirSync(path.dirname(filepath), { recursive: true });

                    // // ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô stream ‡∏•‡∏á‡πÑ‡∏ü‡∏•‡πå
                    // const writable = fs.createWriteStream(filepath);
                    // stream.pipe(writable);

                    // await new Promise((resolve, reject) => {
                    //     writable.on('finish', resolve);
                    //     writable.on('error', reject);
                    // });

                    // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
                    await client.replyMessage(event.replyToken, {
                        type: 'text',
                        text: '‚úÖ ‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ñ‡πà‡∏∞',
                    });

                    console.log(`Saved image to ${filepath}`);
                } catch (err) {
                    console.error('Error handling image message:', err);
                    await client.replyMessage(event.replyToken, {
                        type: 'text',
                        text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏±‡∏ö',
                    });
                }
            }

            if (event.type === 'message' && event.message.type === 'text') {
                const msg = event.message.text;
                console.log("msg", msg)

                if (msg.toLowerCase().includes('‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á')) {
                    // ‡∏™‡πà‡∏á datetime picker ‡∏Å‡∏•‡∏±‡∏ö
                    const reply = {
                        type: 'template',
                        altText: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô',
                        template: {
                            type: 'buttons',
                            text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô?',
                            actions: [
                                {
                                    type: 'datetimepicker',
                                    label: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
                                    data: 'action=checkin',
                                    mode: 'date',
                                }
                            ]
                        }
                    };

                    await client.replyMessage(event.replyToken, reply);
                } else if (msg === "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πà"){
                    const reply = {
                        type: 'template',
                        altText: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô',
                        template: {
                            type: 'buttons',
                            text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô?',
                            actions: [
                                {
                                    type: 'datetimepicker',
                                    label: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
                                    data: 'action=checkin_by_date',
                                    mode: 'date',
                                }
                            ]
                        }
                    };

                    //  await client.pushMessage(userId, {
                    //     type: 'template',
                    //     altText: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô',
                    //     template: {
                    //         type: 'buttons',
                    //         text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô?',
                    //         actions: [
                    //             {
                    //                 type: 'datetimepicker',
                    //                 label: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
                    //                 data: 'action=checkin_by_date',
                    //                 mode: 'date',
                    //             }
                    //         ]
                    //     }
                    // });


                    await client.replyMessage(event.replyToken, reply);
                } else if (msg === '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á') {
                    // ‡∏™‡πà‡∏á QR Code ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ
                    await client.pushMessage(userId, {
                        type: 'image',
                        originalContentUrl: 'https://media.discordapp.net/attachments/1381902530426175498/1400383317504819292/IMG_3658.jpg?ex=688c7018&is=688b1e98&hm=741e0ca13e61210d4a71e604f11b56dcc55d900ac2ee1e1b8f7e2e0249998d09&=&format=webp&width=1182&height=1602',  // ‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå HTTPS
                        previewImageUrl: 'https://media.discordapp.net/attachments/1381902530426175498/1400383317504819292/IMG_3658.jpg?ex=688c7018&is=688b1e98&hm=741e0ca13e61210d4a71e604f11b56dcc55d900ac2ee1e1b8f7e2e0249998d09&=&format=webp&width=1182&height=1602'
//                        originalContentUrl: 'https://drive.google.com/file/d/1YfNuvQ_rh5Kkb_GxNIznHpT84i9cadiK/view?usp=sharing',  // ‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå HTTPS
//                        previewImageUrl: 'https://drive.google.com/file/d/1YfNuvQ_rh5Kkb_GxNIznHpT84i9cadiK/view?usp=sharing'
                    });

                    await client.pushMessage(userId, {
                        type: 'text',
                        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô',
                    });
                } else if (msg === '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á') {
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: '‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö',
                    });
                } else if (msg.includes("‡∏ä‡∏∑‡πà‡∏≠")) {
                    await client.pushMessage(userId, {
                        type: 'flex',
                        altText: 'üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á',
                        contents: {
                            type: 'bubble',
                            body: {
                                type: "box",
                                layout: "vertical",
                                spacing: "md",
                                contents: [
                                    {
                                        type: "text",
                                        text: "üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á",
                                        size: "xl",
                                        weight: "bold",
                                        wrap: true
                                    },
                                    {
                                        type: "box",
                                        layout: "baseline",
                                        spacing: "sm",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "‡∏´‡πâ‡∏≠‡∏á: Deluxe Sea View",
                                                size: "sm",
                                                color: "#555555"
                                            },
                                            {
                                                type: "text",
                                                text: "800 ‡∏ö‡∏≤‡∏ó / ‡∏Ñ‡∏∑‡∏ô * 2 ‡∏Ñ‡∏ô",
                                                size: "sm",
                                                weight: "bold",
                                                color: "#FFBF00"
                                            }
                                        ]
                                    },
                                    {
                                        type: "box",
                                        layout: "baseline",
                                        spacing: "sm",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏∑‡∏ô",
                                                size: "sm",
                                                color: "#555555"
                                            },
                                            {
                                                type: "text",
                                                text: "1 ‡∏Ñ‡∏∑‡∏ô",
                                                size: "sm",
                                                weight: "bold",
                                                color: "#FFBF00"
                                            }
                                        ]
                                    },
                                    {
                                        type: "box",
                                        layout: "baseline",
                                        spacing: "sm",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "‡∏£‡∏ß‡∏°",
                                                size: "sm",
                                                color: "#555555"
                                            },
                                            {
                                                type: "text",
                                                text: "1,600 ‡∏ö‡∏≤‡∏ó",
                                                size: "sm",
                                                weight: "bold",
                                                color: "#FFBF00"
                                            }
                                        ]
                                    },
                                    {
                                        type: "text",
                                        text: "üéâ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ä‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞ Wi-Fi ‡∏ü‡∏£‡∏µ",
                                        size: "sm",
                                        color: "#666666",
                                        wrap: true
                                    },
                                    {
                                        type: "text",
                                        text: "üéâ ‡∏Å‡∏ä‡∏ß‡∏£‡∏£‡∏ì kot@gmail.com",
                                        size: "sm",
                                        color: "#666666",
                                        wrap: true
                                    }
                                ]
                            },
                            footer: {
                                type: "box",
                                layout: "vertical",
                                spacing: "sm",
                                contents: [
                                    {
                                        type: "button",
                                        style: "primary",
                                        color: "#000000",
                                        action: {
                                            type: 'message',
                                            label: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô',
                                            text: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á',
                                        },
                                    },
                                    {
                                        type: "button",
                                        action: {
                                            type: 'message',
                                            label: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                                            text: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á',
                                        }
                                    }
                                ]
                            }
                        }
                    });
                } else if (msg.toLowerCase().includes('‡∏´‡πâ‡∏≠‡∏á')) {
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å?',
                        quickReply: {
                            items: [
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        label: '1 ‡∏Ñ‡∏ô',
                                        data: 'action=select_guest_quantity&guest=1',
                                        text: '1 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        data: 'action=select_guest_quantity&guest=2',
                                        label: '2 ‡∏Ñ‡∏ô',
                                        text: '2 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        data: 'action=select_guest_quantity&guest=3',
                                        label: '3 ‡∏Ñ‡∏ô',
                                        text: '3 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        data: 'action=select_guest_quantity&guest=4',
                                        label: '4 ‡∏Ñ‡∏ô',
                                        text: '4 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        data: 'action=select_guest_quantity&guest=5',
                                        label: '5 ‡∏Ñ‡∏ô',
                                        text: '5 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        data: 'action=select_guest_quantity&guest=6',
                                        label: '6 ‡∏Ñ‡∏ô',
                                        text: '6 ‡∏Ñ‡∏ô'
                                    }
                                }
                            ]
                        }
                    });
                } else if (msg.includes("‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°")) {
                    await client.pushMessage(userId, {
                        type: 'flex',
                        altText: 'üìã ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°',
                        contents: {
                            type: 'bubble',
                            body: {
                                type: "box",
                                layout: "vertical",
                                spacing: "md",
                                contents: [
                                    {
                                        type: "text",
                                        text: "üìã ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°",
                                        size: "xl",
                                        weight: "bold",
                                        wrap: true
                                    },
                                    {
                                        type: "box",
                                        layout: "baseline",
                                        spacing: "sm",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà",
                                                size: "sm",
                                                color: "#555555"
                                            },
                                            {
                                                type: "text",
                                                text: "‡∏ó‡∏≤‡∏á‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°",
                                                size: "sm",
                                                weight: "bold",
                                                color: "#FFBF00"
                                            }
                                        ]
                                    },
                                    {
                                        type: "box",
                                        layout: "baseline",
                                        spacing: "sm",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤",
                                                size: "sm",
                                                color: "#555555"
                                            },
                                            {
                                                type: "text",
                                                text: "‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á",
                                                size: "sm",
                                                weight: "bold",
                                                color: "#FFBF00"
                                            }
                                        ]
                                    },

 
                                ]
                            }

                        }
                    });

                } else if (msg.includes("‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å")) {
                    await client.pushMessage(userId, {
                        type: 'flex',
                        altText: 'üìã ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å',
                        contents: {
                            type: 'bubble',
                            body: {
                                type: "box",
                                layout: "vertical",
                                spacing: "md",
                                contents: [
                                    {
                                        type: "text",
                                        text: "üìã Checkin Plus",
                                        size: "xl",
                                        weight: "bold",
                                        wrap: true
                                    },
                                    {
                                        type: "box",
                                        layout: "baseline",
                                        spacing: "sm",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "555 ‡∏ï‡∏∂‡∏Å‡∏°‡∏≤‡∏£‡πå‡πÄ‡∏ä‡πà‡∏ó‡∏≠‡∏á‡∏´‡∏•‡πà‡∏≠",
                                                size: "sm",
                                                color: "#555555"
                                            },
                                            {
                                                type: "text",
                                                text: "‡πÉ‡∏Å‡∏•‡πâ BTS",
                                                size: "sm",
                                                weight: "bold",
                                                color: "#FFBF00"
                                            }
                                        ]
                                    },
                                ]
                            },
                            footer: {
                                type: "box",
                                layout: "vertical",
                                spacing: "sm",
                                contents: [
                                    {
                                        type: "button",
                                        style: "primary",
                                        color: "#000000",
                                        action: {
                                            type: 'message',
                                            label: '‡∏î‡∏π‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà',
                                            text: '‡∏î‡∏π‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà',
                                        },
                                    },
                                ]
                            }
                        }
                    });
                } else if (msg.includes("‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô")) {
                    await client.pushMessage(userId, {
                        type: 'flex',
                        altText: 'üìã ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô',
                        contents: {
                            type: 'bubble',
                            body: {
                                type: "box",
                                layout: "vertical",
                                spacing: "md",
                                contents: [
                                    {
                                        type: "text",
                                        text: "üìã ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô",
                                        size: "xl",
                                        weight: "bold",
                                        wrap: true
                                    },
                                    {
                                        type: "box",
                                        layout: "baseline",
                                        spacing: "sm",
                                        contents: [

                                            {
                                                type: "text",
                                                text: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ :",
                                                size: "sm",
                                                color: "#555555"
                                            },
                                            {
                                                type: "text",
                                                text: "‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô",
                                                size: "sm",
                                                weight: "bold",
                                                color: "#FFBF00"
                                            }
                                        ]
                                    },
                                    {
                                        type: "box",
                                        layout: "baseline",
                                        spacing: "sm",
                                        contents: [

                                            {
                                                type: "text",
                                                text: "‡∏´‡πâ‡∏≠‡∏á: Deluxe Sea View",
                                                size: "sm",
                                                color: "#555555"
                                            },
                                            {
                                                type: "text",
                                                text: "800 ‡∏ö‡∏≤‡∏ó / ‡∏Ñ‡∏∑‡∏ô * 2 ‡∏Ñ‡∏ô",
                                                size: "sm",
                                                weight: "bold",
                                                color: "#FFBF00"
                                            }
                                        ]
                                    },
                                    {
                                        type: "box",
                                        layout: "baseline",
                                        spacing: "sm",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏∑‡∏ô",
                                                size: "sm",
                                                color: "#555555"
                                            },
                                            {
                                                type: "text",
                                                text: "1 ‡∏Ñ‡∏∑‡∏ô",
                                                size: "sm",
                                                weight: "bold",
                                                color: "#FFBF00"
                                            }
                                        ]
                                    },
                                    {
                                        type: "box",
                                        layout: "baseline",
                                        spacing: "sm",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "‡∏£‡∏ß‡∏°",
                                                size: "sm",
                                                color: "#555555"
                                            },
                                            {
                                                type: "text",
                                                text: "1,600 ‡∏ö‡∏≤‡∏ó",
                                                size: "sm",
                                                weight: "bold",
                                                color: "#FFBF00"
                                            }
                                        ]
                                    },
                                    {
                                        type: "text",
                                        text: "üéâ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏ä‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞ Wi-Fi ‡∏ü‡∏£‡∏µ",
                                        size: "sm",
                                        color: "#666666",
                                        wrap: true
                                    },
                                    {
                                        type: "text",
                                        text: "üéâ ‡∏Å‡∏ä‡∏ß‡∏£‡∏£‡∏ì kot@gmail.com",
                                        size: "sm",
                                        color: "#666666",
                                        wrap: true
                                    }
                                ]
                            },
                            footer: {
                                type: "box",
                                layout: "vertical",
                                spacing: "sm",
                                contents: [
                                    {
                                        type: "button",
                                        style: "primary",
                                        color: "#000000",
                                        action: {
                                            type: 'message',
                                            label: '‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô',
                                            text: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á',
                                        },
                                    },
                                    {
                                        type: "button",
                                        action: {
                                            type: 'uri',
                                            label: '‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î',
                                            uri: "https://example.com/hotel/the-serenity-resort"
                                        }
                                    }
                                ]
                            }
                        }
                    });
                } else if (msg.includes("‡πÅ‡∏ä‡∏£‡πå‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå")) {
                    await client.pushMessage(userId, {
                        type: 'flex',
                        altText: 'üìã ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å',
                        contents: {
                            type: 'bubble',
                            body: {
                                type: "box",
                                layout: "vertical",
                                spacing: "md",
                                contents: [
                                    {
                                        type: "text",
                                        text: "üìã ‡∏£‡πà‡∏ß‡∏°‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤",
                                        size: "xl",
                                        weight: "bold",
                                        wrap: true
                                    },
                                    {
                                        type: "box",
                                        layout: "baseline",
                                        spacing: "sm",
                                        contents: [
                                            {
                                                type: "text",
                                                text: "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏£‡∏µ‡∏ß‡∏¥‡∏ß",
                                                size: "sm",
                                                color: "#555555"
                                            },
                                            {
                                                type: "text",
                                                text: "‡∏Å‡∏±‡∏ö Checkinplus",
                                                size: "sm",
                                                weight: "bold",
                                                color: "#FFBF00"
                                            }
                                        ]
                                    },
                                ]
                            },
                            footer: {
                                type: "box",
                                layout: "vertical",
                                spacing: "sm",
                                contents: [
                                    {
                                        type: "button",
                                        style: "primary",
                                        color: "#000000",
                                        action: {
                                            type: 'message',
                                            label: '‡∏£‡∏µ‡∏ß‡∏¥‡∏ß',
                                            text: '‡∏£‡∏µ‡∏ß‡∏¥‡∏ß',
                                        },
                                    },
                                ]
                            }
                        }
                    });
                } else if (msg.toLowerCase().includes('‡∏Ñ‡∏ô')){
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:\n‡∏ä‡∏∑‡πà‡∏≠: ...\n‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ...\nemail: ...',
                    });
                } else if (msg.toLowerCase().includes('‡πÄ‡∏•‡∏∑‡∏≠‡∏Å')){
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:\n‡∏ä‡∏∑‡πà‡∏≠: ...\n‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ...\nemail: ...',
                    });
 //               } else {
 //                   // ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
 //                   await client.replyMessage(event.replyToken, {
 //                       type: 'text',
 //                       text: '‡∏Ñ‡∏∏‡∏ì‡∏û‡∏¥‡∏°‡∏û‡πå: ' + msg,
 //                   });
                }
            }

            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô postback (‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å datetime)
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô postback (‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å datetime)
            if (event.type === 'postback') {
                const data = event.postback.data;
                const date = event.postback.params?.date;
                console.log("data", event.postback.data)
                if (data === 'action=checkin') {
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô: ${date}\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡∏ï‡πà‡∏≠`,
                    });

                    // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡∏Å datetime picker ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö checkout
                    await client.pushMessage(userId, {
                        type: 'template',
                        altText: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå',
                        template: {
                            type: 'buttons',
                            text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô?',
                            actions: [
                                {
                                    type: 'datetimepicker',
                                    label: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
                                    data: 'action=checkout',
                                    mode: 'date',
                                }
                            ]
                        }
                    });
                } else if (data.includes('checkin_by_date')) {
                    console.log("postback checkin_by_date")
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏∑‡∏ô: ${date}\n‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á!`,
                    });
                    // ‡∏™‡πà‡∏á‡∏≠‡∏µ‡∏Å datetime picker ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö checkout
                    await client.pushMessage(userId, {
                        type: 'template',
                        altText: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå',
                        template: {
                            type: 'buttons',
                            text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô?',
                            actions: [
                                {
                                    type: 'datetimepicker',
                                    label: '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
                                    data: 'action=checkout_by_date',
                                    mode: 'date',
                                }
                            ]
                        }
                    });
                } else if (data==='action=checkout_by_date') {
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå: ${date}\n‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á!`,
                    });


                    await client.pushMessage(userId, {
                        type: 'text',
                        text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å',
                        quickReply: {
                            items: [
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        label: '1 ‡∏Ñ‡∏ô',
                                        data: 'action=select_guest_quantity_flow_pick_date&guest=1',
                                        displayText: '1 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_guest_quantity_flow_pick_date&guest=2',
                                        label: '2 ‡∏Ñ‡∏ô',
                                        displayText: '2 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_guest_quantity_flow_pick_date&guest=3',
                                        label: '3 ‡∏Ñ‡∏ô',
                                        displayText: '3 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_guest_quantity_flow_pick_date&guest=4',
                                        label: '4 ‡∏Ñ‡∏ô',
                                        displayText: '4 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_guest_quantity_flow_pick_date&guest=5',
                                        label: '5 ‡∏Ñ‡∏ô',
                                        displayText: '5 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_guest_quantity_flow_pick_date&guest=6',
                                        label: '6 ‡∏Ñ‡∏ô',
                                        displayText: '6 ‡∏Ñ‡∏ô'
                                    }
                                }
                            ]
                        }
                    });
                } else if (data === 'action=checkout') {
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå: ${date}\n‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á!`,
                    });


                    await client.pushMessage(userId, {
                        type: 'text',
                        text: '‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô?',
                        quickReply: {
                            items: [
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        label: '1 ‡∏´‡πâ‡∏≠‡∏á',
                                        data: 'action=select_room_quantity&room=1',
                                        text: '1 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_room_quantity&room=2',
                                        label: '2 ‡∏´‡πâ‡∏≠‡∏á',
                                        text: '2 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_room_quantity&room=3',
                                        label: '3 ‡∏´‡πâ‡∏≠‡∏á',
                                        text: '3 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_room_quantity&room=4',
                                        label: '4 ‡∏´‡πâ‡∏≠‡∏á',
                                        text: '4 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_room_quantity&room=5',
                                        label: '5 ‡∏´‡πâ‡∏≠‡∏á',
                                        text: '5 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_room_quantity&room=6',
                                        label: '6 ‡∏´‡πâ‡∏≠‡∏á',
                                        text: '6 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                }
                            ]
                        }
                    });
                }else if (data.includes("guest_information_flow_pick_date")) {
                    await client.pushMessage(userId, {
                        type: "flex",
                        altText: "‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥",
                        contents: {
                            type: "bubble",
                            hero: {
                            type: "image",
                            url: "https://cdn.pixabay.com/photo/2016/11/29/04/17/architecture-1867187_1280.jpg", // ‡∏£‡∏π‡∏õ‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡∏™‡∏ß‡∏¢ ‡πÜ
                            size: "full",
                            aspectRatio: "20:13",
                            aspectMode: "cover"
                            },
                            body: {
                            type: "box",
                            layout: "vertical",
                            spacing: "md",
                            contents: [
                                {
                                type: "text",
                                text: "The Serenity Resort",
                                weight: "bold",
                                size: "xl",
                                wrap: true
                                },
                                {
                                type: "text",
                                text: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏ø3,200 / ‡∏Ñ‡∏∑‡∏ô",
                                size: "lg",
                                weight: "bold",
                                color: "#FF6B6B"
                                },
                                {
                                type: "text",
                                text: "‡∏£‡∏µ‡∏™‡∏≠‡∏£‡πå‡∏ó‡∏´‡∏£‡∏π‡∏£‡∏¥‡∏°‡∏ó‡∏∞‡πÄ‡∏• ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏™‡∏á‡∏ö ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô",
                                size: "sm",
                                color: "#666666",
                                wrap: true
                                }
                            ]
                            },
                            footer: {
                            type: "box",
                            layout: "vertical",
                            spacing: "sm",
                            contents: [
                                {
                                type: "button",
                                style: "secondary",
                                action: {
                                    type: "uri",
                                    label: "‡∏î‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°",
                                    uri: "https://example.com/hotel/the-serenity-resort"
                                }
                                },
                                {
                                type: "button",
                                style: "primary",
                                color: "#000000",
                                action: {
                                    type: "message",
                                    label: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å",
                                    text: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"
                                }
                                }
                            ]
                            }
                        }
                        });
                } else if (data.includes("action=select_guest_quantity_flow_pick_date")) {
                    console.log("case", "select_guest_quantity_flow_pick_date")
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Å‡∏µ‡πà‡∏´‡πâ‡∏≠‡∏á',
                        quickReply: {
                            items: [
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        label: '1 ‡∏´‡πâ‡∏≠‡∏á',
                                        data: 'action=select_room_quantity_flow_pick_date&room=1',
                                        displayText: '1 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_room_quantity_flow_pick_date&room=2',
                                        label: '2 ‡∏´‡πâ‡∏≠‡∏á',
                                        displayText: '2 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_room_quantity_flow_pick_date&room=3',
                                        label: '3 ‡∏´‡πâ‡∏≠‡∏á',
                                        displayText: '3 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_room_quantity_flow_pick_date&room=4',
                                        label: '4 ‡∏´‡πâ‡∏≠‡∏á',
                                        displayText: '4 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_room_quantity_flow_pick_date&room=5',
                                        label: '5 ‡∏´‡πâ‡∏≠‡∏á',
                                        displayText: '5 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'postback',
                                        data: 'action=select_room_quantity_flow_pick_date&room=6',
                                        label: '6 ‡∏´‡πâ‡∏≠‡∏á',
                                        displayText: '6 ‡∏´‡πâ‡∏≠‡∏á'
                                    }
                                }
                            ]
                        }
                    });
                } else if (data.includes("select_room_quantity_flow_pick_date")) {
                    console.log("sendproductcard")
                    await client.pushMessage(userId, {
                        type: "flex",
                        altText: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£",
                        contents: {
                            type: "carousel",
                            contents: [
                            {
                                type: "bubble",
                                hero: {
                                type: "image",
                                url: "https://media.discordapp.net/attachments/1381902530426175498/1402898204554428477/IMG_3059.png?ex=68959644&is=689444c4&hm=be4667840bbb47185da09f633e61826cf9aeb3e794a584b39fe2aef3c09fb4a0&=&format=webp&quality=lossless&width=1656&height=924",
                                size: "full",
                                aspectRatio: "20:13",
                                aspectMode: "cover"
                                },
                                body: {
                                type: "box",
                                layout: "vertical",
                                spacing: "md",
                                contents: [
                                    {
                                    type: "text",
                                    text: "The Serenity Resort",
                                    weight: "bold",
                                    size: "xl",
                                    wrap: true
                                    },
                                    {
                                    type: "text",
                                    text: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏ø3,200 / ‡∏Ñ‡∏∑‡∏ô",
                                    size: "lg",
                                    weight: "bold",
                                    color: "#FF6B6B"
                                    },
                                    {
                                    type: "text",
                                    text: "‡∏£‡∏µ‡∏™‡∏≠‡∏£‡πå‡∏ó‡∏´‡∏£‡∏π‡∏£‡∏¥‡∏°‡∏ó‡∏∞‡πÄ‡∏• ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡∏™‡∏á‡∏ö ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô",
                                    size: "sm",
                                    color: "#666666",
                                    wrap: true
                                    }
                                ]
                                },
                                footer: {
                                type: "box",
                                layout: "vertical",
                                spacing: "sm",
                                contents: [
                                    {
                                    type: "button",
                                    style: "secondary",
                                    action: {
                                        type: "uri",
                                        label: "‡∏î‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°",
                                        uri: "https://example.com/hotel/the-serenity-resort"
                                    }
                                    },
                                    {
                                    type: "button",
                                    style: "primary",
                                    color: "#000000",
                                    action: {
                                        type: "message",
                                        label: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å",
                                        text: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"
                                    }
                                    }
                                ]
                                }
                            },
                            {
                                type: "bubble",
                                hero: {
                                type: "image",
                                url: "https://media.discordapp.net/attachments/1381902530426175498/1402898204554428477/IMG_3059.png?ex=68959644&is=689444c4&hm=be4667840bbb47185da09f633e61826cf9aeb3e794a584b39fe2aef3c09fb4a0&=&format=webp&quality=lossless&width=1656&height=924",
                                size: "full",
                                aspectRatio: "20:13",
                                aspectMode: "cover"
                                },
                                body: {
                                type: "box",
                                layout: "vertical",
                                spacing: "md",
                                contents: [
                                    {
                                    type: "text",
                                    text: "Ocean Breeze Villa",
                                    weight: "bold",
                                    size: "xl",
                                    wrap: true
                                    },
                                    {
                                    type: "text",
                                    text: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏ø4,500 / ‡∏Ñ‡∏∑‡∏ô",
                                    size: "lg",
                                    weight: "bold",
                                    color: "#FF6B6B"
                                    },
                                    {
                                    type: "text",
                                    text: "‡∏ß‡∏¥‡∏•‡∏•‡πà‡∏≤‡∏£‡∏¥‡∏°‡∏ä‡∏≤‡∏¢‡∏´‡∏≤‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ß‡∏¥‡∏ß‡∏ó‡∏∞‡πÄ‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏°",
                                    size: "sm",
                                    color: "#666666",
                                    wrap: true
                                    }
                                ]
                                },
                                footer: {
                                type: "box",
                                layout: "vertical",
                                spacing: "sm",
                                contents: [
                                    {
                                    type: "button",
                                    style: "secondary",
                                    action: {
                                        type: "uri",
                                        label: "‡∏î‡∏π‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°",
                                        uri: "https://example.com/hotel/ocean-breeze-villa"
                                    }
                                    },
                                    {
                                    type: "button",
                                    style: "primary",
                                    color: "#000000",
                                    action: {
                                        type: "message",
                                        label: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å",
                                        text: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å"
                                    }
                                    }
                                ]
                                }
                            }
                            ]
                        }
                        });


                //    await client.pushMessage(userId, {
                //     type: 'template',
                //     altText: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á',
                //     template: {
                //         type: 'buttons',
                //         text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:\n‡∏ä‡∏∑‡πà‡∏≠: ...\n‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ...\nemail: ...',
                //         actions: [
                //         {
                //             type: 'postback',
                //             label: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                //             data: 'action=guest_information_flow_pick_date'
                //         }
                //         ]
                //     }
                //     });
                } else if (data.includes("select_room_quantity")) {
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å?',
                        quickReply: {
                            items: [
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        label: '1 ‡∏Ñ‡∏ô',
                                        data: 'action=select_guest_quantity&guest=1',
                                        text: '1 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        data: 'action=select_guest_quantity&guest=2',
                                        label: '2 ‡∏Ñ‡∏ô',
                                        text: '2 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        data: 'action=select_guest_quantity&guest=3',
                                        label: '3 ‡∏Ñ‡∏ô',
                                        text: '3 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        data: 'action=select_guest_quantity&guest=4',
                                        label: '4 ‡∏Ñ‡∏ô',
                                        text: '4 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        data: 'action=select_guest_quantity&guest=5',
                                        label: '5 ‡∏Ñ‡∏ô',
                                        text: '5 ‡∏Ñ‡∏ô'
                                    }
                                },
                                {
                                    type: 'action',
                                    action: {
                                        type: 'message',
                                        data: 'action=select_guest_quantity&guest=6',
                                        label: '6 ‡∏Ñ‡∏ô',
                                        text: '6 ‡∏Ñ‡∏ô'
                                    }
                                }
                            ]
                        }
                    });
                }   else if (data.startsWith("select_guest_quantity")) {
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö:\n‡∏ä‡∏∑‡πà‡∏≠: ...\n‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: ...\nemail: ...',
                    });
                }
            }
           if (event.type === 'message' && event.message.type === 'text') {
                const msg = event.message.text;

                if (msg.toLowerCase().includes('‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°')) {
                   
                   const reply = {
                        type: 'templet',
                        altText: '‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°',
                        template: {
                            type: 'action',
                            text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏ó‡∏≤‡∏á‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°',
                            action: [
                                {
                                    type: 'message',
                                    label : '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°',
                                    text : '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°',
                                }
                            ]
                        }
                    };
                    await client.replyMessage(event.replyToken, reply);
                
                } else if (msg.toLowerCase().includes('‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°2')) {
                    await client.pushMessage(userId, {
                        type: 'text',
                        text: '‡∏≠‡∏¥‡∏≠‡∏¥',
                    });
                }
            }         

        }
        res.status(200).send('OK');
    } catch (error) {
        res.status(200).send('OK');
    }
});

// ‡∏ü‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}`);
});